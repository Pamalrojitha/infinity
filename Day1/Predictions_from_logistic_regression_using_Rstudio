#Importing Libraries

library(knitr)
library(tidyverse)
library(ggplot2)
library(mice)
library(lattice)
library(reshape2)
library(DataExplorer)
library(dplyr)
library(readxl)

#importing data sets and prepring data according to requirements of processing

credit_card_default_train <- read.csv("credit_card_default_train.csv")
View(credit_card_default_train)
str(credit_card_default_train)
data.matrix(credit_card_default_train)
credit_card_default_train[]<-data.matrix(credit_card_default_train)
str(credit_card_default_train)
credit_card_default_train[, 1:25] <- sapply(credit_card_default_train[, 1:25], as.numeric)
str(credit_card_default_train)
credit_card_default_test <- read.csv("credit_card_default_test.csv")
View(credit_card_default_test)
credit_card_default_test[]<-data.matrix(credit_card_default_test)
credit_card_default_test[, 1:24] <- sapply(credit_card_default_test[, 1:24], as.numeric)

#exploratory data analysis

summary(credit_card_default_train)
introduce(credit_card_default_train)
count(credit_card_default_train, vars =  EDUCATION_STATUS)
count(credit_card_default_train, vars =  Balance_Limit_V1)
count(credit_card_default_train, vars =  Gender  )
count(credit_card_default_train, vars =  MARITAL_STATUS)
count(credit_card_default_train, vars =  AGE  )
plot_correlation(na.omit(credit_card_default_train), maxcat = 5L)
#according to analysis there were no missing values as well as outliers

#Feature Engineering

#deleting columns with no correlation to next_month_defualt
credit_card_new <- select(credit_card_default_train, -one_of('Client_ID','DUE_AMT_JULY', 'DUE_AMT_AUG',
                                 'DUE_AMT_SEP','DUE_AMT_OCT','DUE_AMT_NOV','DUE_AMT_DEC'))
head(credit_card_new)

#Pre-processing

credit_card_new [, 1:17] <- scale(credit_card_new [, 1:17])
head(credit_card_new)
card_data = sort(sample(nrow(credit_card_new), nrow(credit_card_new)*.7))
train <- credit_card_new[card_data,]
test<- credit_card_new[-card_data,]

#Developing Model

logisticR.model <- glm(NEXT_MONTH_DEFAULT ~., data =train, family = binomial(link = "logit"))
summary(logisticR.model)

#Predicting and accuracy checking

logisticR.predictions <- predict(logisticR.model, test, type="response")
logisticR.predictions
logisticR.predictions.correct <- ifelse(logisticR.predictions > 0.5, 1, 0)
logisticR.predictions.correct 
table(logisticR.predictions.correct, test[,18])
accuracy <- table(logisticR.predictions.correct, test[,18])
sum(diag(accuracy))/sum(accuracy)

logisticR.predictions <- predict(logisticR.model, credit_card_default_test, type="response")
logisticR.predictions
logisticR.predictions.correct <- ifelse(logisticR.predictions > 0.5, 1, 0)
logisticR.predictions.correct 
write.table(logisticR.predictions.correct,file = "Predictions.csv",sep=",")
